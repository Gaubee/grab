# CLI-First é‡æ„è¿›åº¦æŠ¥å‘Š

## æ—¥æœŸ: 2025-10-29

## å·²å®Œæˆçš„å·¥ä½œ âœ…

### é˜¶æ®µ 1: åŸºç¡€ CLI é‡æ„ (100% å®Œæˆ)

#### 1. å¹³å°æ£€æµ‹æ¨¡å— (`src/utils/platform-detect.ts`)
- âœ… è‡ªåŠ¨æ£€æµ‹å½“å‰å¹³å°å’Œæ¶æ„
- âœ… æ”¯æŒå¤šç§å¹³å°åˆ«å (darwin/macos/osx, windows/win32, etc.)
- âœ… æ”¯æŒå¤šç§æ¶æ„åˆ«å (x64/x86_64/amd64, arm64/aarch64, etc.)
- âœ… æ™ºèƒ½å­—ç¬¦ä¸²åŒ¹é… (containsPlatform, containsArch)
- âœ… åˆ«åæšä¸¾åŠŸèƒ½ (ç”¨äºç”ŸæˆåŒ¹é…æ¨¡å¼)

**æ ¸å¿ƒåŠŸèƒ½**:
```typescript
detectPlatform()  // 'linux' | 'darwin' | 'windows'
detectArch()      // 'x64' | 'arm64' | 'x86' | 'arm'
normalizePlatform(alias)  // æ ‡å‡†åŒ–åˆ«å
containsPlatform(str, platform)  // æ™ºèƒ½åŒ¹é…
```

#### 2. é…ç½®æ–‡ä»¶å¯é€‰åŒ– (`src/config.ts`)
- âœ… `loadConfig()` ç°åœ¨è¿”å› `Partial<GrabConfig>`
- âœ… æ²¡æœ‰é…ç½®æ–‡ä»¶æ—¶è¿”å›ç©ºå¯¹è±¡è€Œä¸æ˜¯æŠ›å‡ºé”™è¯¯
- âœ… æ·»åŠ  `configFileExists()` è¾…åŠ©å‡½æ•°
- âœ… æ‰©å±• `GrabConfig` æ¥å£æ”¯æŒæ–°çš„ CLI å‚æ•°
  - `platform`, `arch`, `output`, `extract`, `cleanup`, `name`
  - `concurrency`, `maxRetries`, `cacheDir`

**å…³é”®æ”¹å˜**:
```typescript
// æ—§ç‰ˆæœ¬ - é…ç½®æ–‡ä»¶å¿…é¡»
export async function loadConfig(): Promise<GrabConfig> {
  if (!config) throw new Error("Config not found");
  if (!config.repo || !config.assets) throw new Error("Missing fields");
  return config;
}

// æ–°ç‰ˆæœ¬ - é…ç½®æ–‡ä»¶å¯é€‰
export async function loadConfig(): Promise<Partial<GrabConfig>> {
  if (!config) return {};  // è¿”å›ç©ºå¯¹è±¡ï¼Œä¸æŠ›é”™
  return config;
}
```

#### 3. èµ„æºæ™ºèƒ½åŒ¹é… (`src/utils/asset-matcher.ts`)
- âœ… åŸºäºå¹³å°/æ¶æ„æ™ºèƒ½åŒ¹é…èµ„æº
- âœ… æ”¯æŒç²¾ç¡®æ–‡ä»¶ååŒ¹é…
- âœ… æ”¯æŒå…³é”®è¯æ•°ç»„åŒ¹é…
- âœ… åŒ¹é…æ‰“åˆ†ç³»ç»Ÿ (0-100)
- âœ… æ™ºèƒ½å»ºè®®åŠŸèƒ½ (å½“åŒ¹é…å¤±è´¥æ—¶)
- âœ… å‹å¥½çš„é”™è¯¯ä¿¡æ¯ç”Ÿæˆ

**åŒ¹é…é€»è¾‘**:
- ç²¾ç¡®åç§°åŒ¹é…: 100 åˆ†
- å¹³å° + æ¶æ„åŒ¹é…: 90 åˆ†
- ä»…å¹³å°åŒ¹é…: 50 åˆ†
- ä»…æ¶æ„åŒ¹é…: 40 åˆ†

#### 4. å†…ç½®åå¤„ç†æ’ä»¶ (`src/utils/builtin-plugins.ts`)
- âœ… `buildBuiltinPlugins()` æ ¹æ® CLI é€‰é¡¹ç”Ÿæˆæ’ä»¶
- âœ… æ”¯æŒ `--extract` (è‡ªåŠ¨è§£å‹)
- âœ… æ”¯æŒ `--cleanup` (åˆ é™¤åŸå§‹æ–‡ä»¶)
- âœ… æ”¯æŒ `--output` (ç§»åŠ¨åˆ°ç›®æ ‡ä½ç½®)
- âœ… `isArchive()` æ£€æµ‹æ˜¯å¦ä¸ºå‹ç¼©åŒ…
- âœ… `guessBinaryName()` ä»ä»“åº“åæ¨æ–­äºŒè¿›åˆ¶å

**æ’ä»¶æ‰§è¡Œé¡ºåº**:
1. Extract (å¦‚æœå¯ç”¨)
2. Copy to output (å¦‚æœæŒ‡å®š)
3. Cleanup (å¦‚æœå¯ç”¨)

#### 5. é‡æ„ CLI (`src/cli.ts`)
- âœ… **æ”¯æŒä½ç½®å‚æ•°**: `grab <repo>`
- âœ… **æ–°çš„ CLI å‚æ•°**:
  - `--platform, -p` - å¹³å°é€‰æ‹©
  - `--arch, -a` - æ¶æ„é€‰æ‹©
  - `--output, -o` - è¾“å‡ºè·¯å¾„
  - `--extract, -e` - è‡ªåŠ¨è§£å‹
  - `--cleanup, -c` - æ¸…ç†å‹ç¼©åŒ…
  - `--name, -n` - ç²¾ç¡®æ–‡ä»¶ååŒ¹é…
  - `--verbose, -v` - è¯¦ç»†è¾“å‡º
  - `--quiet, -q` - é™é»˜æ¨¡å¼
- âœ… **æ™ºèƒ½é»˜è®¤å€¼**: è‡ªåŠ¨æ£€æµ‹å¹³å°å’Œæ¶æ„
- âœ… **é…ç½®æ–‡ä»¶å¯é€‰**: å®Œå…¨å¯ä»¥é€šè¿‡ CLI å‚æ•°ä½¿ç”¨
- âœ… **å‚æ•°ä¼˜å…ˆçº§**: CLI > é…ç½®æ–‡ä»¶ > è‡ªåŠ¨æ£€æµ‹ > é»˜è®¤å€¼
- âœ… **å‹å¥½çš„é”™è¯¯æç¤º**: éªŒè¯ repo æ ¼å¼ï¼Œæä¾›ä½¿ç”¨å»ºè®®

**æ ¸å¿ƒç‰¹æ€§**:
```bash
# é›¶é…ç½®ä½¿ç”¨
grab oven-sh/bun

# å®Œæ•´çš„ CLI æ§åˆ¶
grab oven-sh/bun --platform linux --arch x64 -o ./bin/bun --extract --cleanup

# é…ç½®æ–‡ä»¶ + CLI å‚æ•°è¦†ç›–
grab --tag v1.0.31  # ä½¿ç”¨é…ç½®æ–‡ä»¶ï¼Œä½†è¦†ç›– tag
```

#### 6. æ–‡æ¡£ (`README.md`)
- âœ… å®Œæ•´çš„ README.md
- âœ… å¿«é€Ÿå¼€å§‹æŒ‡å—
- âœ… æ‰€æœ‰ CLI å‚æ•°è¯´æ˜
- âœ… é…ç½®æ–‡ä»¶ç¤ºä¾‹
- âœ… å¸¸è§ç”¨ä¾‹
- âœ… æ•…éšœæ’æŸ¥æŒ‡å—
- âœ… API ä½¿ç”¨ç¤ºä¾‹

### ä»£ç è´¨é‡æ”¹è¿›

#### ç±»å‹å®‰å…¨
- âœ… æ‰€æœ‰æ–°æ¨¡å—éƒ½æœ‰å®Œæ•´çš„ TypeScript ç±»å‹å®šä¹‰
- âœ… æ²¡æœ‰ä½¿ç”¨ `any` ç±»å‹
- âœ… ä½¿ç”¨ `Platform` å’Œ `Architecture` ç±»å‹åˆ«å

#### ä»£ç ç»„ç»‡
- âœ… åˆ›å»º `utils/` ç›®å½•ç»„ç»‡è¾…åŠ©æ¨¡å—
- âœ… æ¯ä¸ªæ¨¡å—èŒè´£å•ä¸€ã€æ¸…æ™°
- âœ… å®Œæ•´çš„ JSDoc æ³¨é‡Š

#### å‘åå…¼å®¹
- âœ… ä¿ç•™äº†æ—§çš„ cli.ts ä¸º cli.old.ts
- âœ… é…ç½®æ–‡ä»¶æ ¼å¼å‘åå…¼å®¹
- âœ… æ—§çš„ `assets` é…ç½®ä»ç„¶å·¥ä½œ

## å…³é”®æ”¹è¿›å¯¹æ¯”

### ä½¿ç”¨ä½“éªŒå¯¹æ¯”

#### æ—§ç‰ˆæœ¬ (Config-First)
```bash
# 1. å¿…é¡»åˆ›å»ºé…ç½®æ–‡ä»¶
cat > grab.config.ts << EOF
export default {
  repo: "oven-sh/bun",
  assets: [{ name: ["linux", "x64"], targetPath: "./bin/bun" }]
}
EOF

# 2. è¿è¡Œ
npx @gaubee/grab
```

#### æ–°ç‰ˆæœ¬ (CLI-First)
```bash
# ä¸€è¡Œæå®šï¼Œé›¶é…ç½®
grab oven-sh/bun -o ./bin/bun --extract
```

### åŠŸèƒ½å¯¹æ¯”è¡¨

| åŠŸèƒ½ | æ—§ç‰ˆæœ¬ | æ–°ç‰ˆæœ¬ |
|------|--------|--------|
| é›¶é…ç½®å¯ç”¨ | âŒ å¿…é¡»æœ‰é…ç½®æ–‡ä»¶ | âœ… å®Œå…¨é›¶é…ç½® |
| ä½ç½®å‚æ•° | âŒ | âœ… `grab <repo>` |
| å¹³å°æ£€æµ‹ | âŒ | âœ… è‡ªåŠ¨æ£€æµ‹ |
| æ™ºèƒ½åŒ¹é… | âš ï¸ ä»…å…³é”®è¯ | âœ… å¹³å°/æ¶æ„/åˆ«å |
| å†…ç½®è§£å‹ | âŒ éœ€è¦æ‰‹åŠ¨é…ç½®æ’ä»¶ | âœ… `--extract` |
| å‹å¥½é”™è¯¯ | âŒ | âœ… å»ºè®®å’Œæç¤º |
| README | âŒ | âœ… å®Œæ•´æ–‡æ¡£ |

## ç¼–è¯‘éªŒè¯ âœ…

```bash
npm run build
# âœ… ç¼–è¯‘æˆåŠŸï¼Œæ— é”™è¯¯
# âœ… ç”Ÿæˆ bundle/cli.js (1668.87 kB)
# âœ… ç”Ÿæˆç±»å‹å®šä¹‰æ–‡ä»¶
```

## ä¸‹ä¸€æ­¥è®¡åˆ’

### çŸ­æœŸ (æœ¬å‘¨)
1. **æµ‹è¯•**: ç¼–å†™å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•
2. **å­å‘½ä»¤**: å®ç° `grab list`, `grab init`, `grab cache`
3. **é”™è¯¯å¤„ç†**: æ”¹è¿›é”™è¯¯ä¿¡æ¯å’Œå»ºè®®

### ä¸­æœŸ (ä¸‹å‘¨)
1. **é…ç½®å¢å¼º**: æ”¯æŒ `defaults`, `aliases`, `presets`
2. **æ–‡æ¡£**: API æ–‡æ¡£ï¼Œç”¨æˆ·æŒ‡å—
3. **ç¤ºä¾‹**: æ·»åŠ å¸¸è§ç”¨ä¾‹ç¤ºä¾‹

### é•¿æœŸ (æœ¬æœˆ)
1. **æ€§èƒ½ä¼˜åŒ–**: å¹¶å‘æ§åˆ¶ï¼Œç¼“å­˜ç®¡ç†
2. **ç¤¾åŒº**: è´¡çŒ®æŒ‡å—ï¼ŒIssue æ¨¡æ¿
3. **CI/CD**: GitHub Actionsï¼Œè‡ªåŠ¨å‘å¸ƒ

## é£é™©å’ŒæŒ‘æˆ˜

### å·²è¯†åˆ«çš„é£é™©
1. **å‘åå…¼å®¹æ€§**: éœ€è¦ç¡®ä¿æ—§é…ç½®æ–‡ä»¶ä»ç„¶å·¥ä½œ âœ… (å·²é€šè¿‡ä¿ç•™æ—§é€»è¾‘è§£å†³)
2. **æµ‹è¯•è¦†ç›–**: æ–°ä»£ç ç¼ºå°‘æµ‹è¯• âš ï¸ (è®¡åˆ’ä¸­)
3. **æ–‡æ¡£åŒæ­¥**: éœ€è¦ç¡®ä¿æ–‡æ¡£ä¸ä»£ç ä¸€è‡´ âœ… (README å·²å®Œæˆ)

### ç¼“è§£ç­–ç•¥
1. ä¿ç•™æ—§çš„ CLI å®ç°ä½œä¸ºå¤‡ä»½
2. æä¾›è¿ç§»æŒ‡å— (è®¡åˆ’ä¸­)
3. æ¸è¿›å¼å‘å¸ƒ (å…ˆ beta ç‰ˆæœ¬)

## æˆåŠŸæŒ‡æ ‡

### å®Œæˆæƒ…å†µ
- âœ… é›¶é…ç½®å¯ç”¨ (100%)
- âœ… å¹³å°è‡ªåŠ¨æ£€æµ‹ (100%)
- âœ… README æ–‡æ¡£ (100%)
- â³ æµ‹è¯•è¦†ç›–ç‡ > 80% (0% â†’ è®¡åˆ’ä¸­)
- âœ… ä»£ç ç¼–è¯‘æ— é”™è¯¯ (100%)

### ç”¨æˆ·ä½“éªŒ
- âœ… ä»"å¿…é¡»é…ç½®"åˆ°"å¼€ç®±å³ç”¨"
- âœ… ä»"å¤æ‚å‘½ä»¤"åˆ°"ä¸€è¡Œæå®š"
- âœ… ä»"æ— æ–‡æ¡£"åˆ°"å®Œæ•´æ–‡æ¡£"

## æ€»ç»“

**ä»Šå¤©å®Œæˆäº† CLI-First é‡æ„çš„ç¬¬ä¸€é˜¶æ®µ (100%)**ï¼š

1. âœ… åˆ›å»ºäº† 4 ä¸ªæ–°æ¨¡å— (platform-detect, asset-matcher, builtin-plugins, cli)
2. âœ… ä¿®æ”¹äº† config.ts è®©é…ç½®æ–‡ä»¶å˜ä¸ºå¯é€‰
3. âœ… åˆ›å»ºäº†å®Œæ•´çš„ README.md
4. âœ… ä»£ç ç¼–è¯‘æˆåŠŸï¼Œæ— é”™è¯¯
5. âœ… å®ç°äº†é›¶é…ç½®ä½¿ç”¨çš„æ ¸å¿ƒç›®æ ‡

**æ ¸å¿ƒç†å¿µè½¬å˜**:
> ä» "å¿…é¡»é…ç½®æ‰èƒ½ç”¨" â†’ "å¼€ç®±å³ç”¨ï¼ŒæŒ‰éœ€é…ç½®"

**ä¸‹ä¸€æ­¥**: ç¼–å†™æµ‹è¯•ï¼Œå®ç°å­å‘½ä»¤ï¼Œå®Œå–„é”™è¯¯å¤„ç†ã€‚

---

**è¿›åº¦**: é˜¶æ®µ 1 å®Œæˆ âœ… | é˜¶æ®µ 2 ç­‰å¾…ä¸­ â³ | é˜¶æ®µ 3-4 è®¡åˆ’ä¸­ ğŸ“‹
